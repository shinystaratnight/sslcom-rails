= stylesheet_link_tag "compiled/main"
= stylesheet_link_tag "compiled/print", :media=>'print'
/[if lt IE 8]
  = stylesheet_link_tag "compiled/ie"
= stylesheet_link_tag "farbtastic/farbtastic" if Rails.env.development?
= stylesheet_link_tag "jquery-ui-1.7.2.custom.css"
= stylesheet_link_tag "jquery.tooltip"
= stylesheet_link_tag "prettyPhoto"
= javascript_include_tag :defaults
= javascript_include_tag "jquery.form"
= javascript_include_tag "jquery.prettyPhoto"
= javascript_include_tag "jquery.livequery"
= javascript_include_tag "multifile/jquery.MetaData"
= javascript_include_tag "multifile/jquery.MultiFile.pack"
= javascript_include_tag "multifile/jquery.blockUI"
= javascript_include_tag "jquery-ui-1.7.2.custom.min"
= javascript_include_tag "jquery.cookie"
= javascript_include_tag "jquery.format.1.02"
= javascript_include_tag "jquery.tooltip.min"
= javascript_include_tag "jCal"
= javascript_include_tag "/farbtastic/farbtastic" if Rails.env.development?
= javascript_include_tag "jquery.json"
= javascript_include_tag "datejs"
/[if IE]
  = javascript_include_tag "jquery.bgiframe.pack"

:javascript
  jQuery(function($){
    $('div.flash_message a.close').click(function(){
      $(this).parents().filter('div.flash_message').hide();
    });
    $("a[rel^='prettyPhoto']").prettyPhoto({allowresize:false, theme:'facebook', showTitle:false});
    $('.striped_div > div:nth-child(odd)').css("background-color","#eeeeee");
    $('.striped_tr tr:nth-child(odd)').css("background-color","#eeeeee");
    $('#close_window').click(function(){
      window.close();
    });
    //#{"$('#colorpicker').farbtastic('.color');" if Rails.env.development?}
    //cart functions
    $.toMoneyFloat = function(money){
      money = money.replace(",","");
      money = money.replace("$","");
      var usdIndex = money.indexOf(" USD");
      if(usdIndex!=-1)
        money = money.substring(0,usdIndex)
      return money;
    }
    $.adjust_items_in_cart = function(){
      var items = "items";
      var howMany = ($.cookie("cart")==null)? 0 : $.cookie("cart").split(":").length-1;
      if(howMany==1)
        items = "item";
      $("#cart_size").text(howMany.toString()+" "+items+" in cart")
    };
    $.adjust_order_total = function(){
      var total = 0;
      $('.amount').each(function(){
        total += parseFloat($.toMoneyFloat($(this).text()));
      });
      total=(total!=0)?total.toFixed(2).toString():"0.00";
      $('#cart_total').text('$'+total+" USD");
    };
    $.empty_out_cart = function(){
      $.cookie("cart", "", {path: '/'});
      $.cookie("aid_li", "", {path: '/'});
      $('.add_to_cart_button').attr("disabled","");
      $('#cart','#cart_total').effect("highlight", {}, 3000);
    };
    $('#empty_cart').click(function(){
      $.empty_out_cart();
    })
    $('.remove_from_cart_link').click(function(){
      var cart = $.cookie("cart");
      if(cart==null)
        return;
      var affiliateLineItem = $.cookie("aid_li");
      var id = $(this).attr("id")
      var index = cart.indexOf(id);
      if(index!=-1){
        var items_array = cart.split(":");
        var affiliates_array = affiliateLineItem.split(":");
        for(i=0;i<items_array.length;i++){
          if(items_array[i]==id){
            items_array.splice(i,1);
            affiliates_array.splice(i,1);
            break;
          }
        }
        cart = items_array.join(":");
        affiliateLineItem = affiliates_array.join(":");
        $.cookie("cart", cart, { expires: #{AppConfig.cart_cookie_days}, path: '/'});
        $.cookie("aid_li", affiliateLineItem, { expires: #{AppConfig.affiliate_cookie_days}, path: '/'});
        $(this).parents('tr[id='+$(this).attr("id")+']').
          fadeOut('slow', function(){
            $(this).remove();
            $.adjust_items_in_cart();
            $.adjust_order_total();
            $('#cart','#cart_total').effect("highlight", {}, 3000);}
          );
      }
    });
    // Array Remove - By John Resig (MIT Licensed)
    Array.prototype.remove = function(from, to) {
      var rest = this.slice((to || from) + 1 || this.length);
      this.length = from < 0 ? this.length + from : from;
      return this.push.apply(this, rest);
    };
    Array.prototype.find = function(searchStr) {
      var returnArray = false;
      for (i=0; i<this.length; i++) {
        if (typeof(searchStr) == 'function') {
          if (searchStr.test(this[i])) {
            if (!returnArray) { returnArray = [] }
            returnArray.push(i);
          }
        } else {
          if (this[i]===searchStr) {
            if (!returnArray) { returnArray = [] }
            returnArray.push(i);
          }
        }
      }
      return returnArray;
    };
    $.adjust_items_in_cart();
    /* Easiest Tooltips CONFIG */
    // these 2 variable determine popup's distance from the cursor
    // you might want to adjust to get the right result
    var xOffset = 10;
    var yOffset = 30;
    /* END CONFIG */
  });
