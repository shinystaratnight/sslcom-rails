-title = "Domains"
-content_for :title, title
-system_admins = current_user.is_system_admins?
=render :partial => 'index_scripts'
#search_bar
  =form_tag domains_path, id: 'add_domains', method: :post do
    Input domain name(s) (separated by commas or spaces)
    =text_field_tag :domain_names, params[:domains]
    =button_tag 'Add', id: 'btn_add_domains'

=form_tag '', id: 'domains_list', method: :post do
  #validations
    %table(cellspacing="0")
      -if will_paginate @domains
        %tfoot
          %tr
            %td.wrap_number_rows(colspan='2')
              =select_tag :number_rows,
              options_for_select([[5, 5], [10, 10], [20, 20], [50, 50], [100, 100]], @per_page),
              :class=>'per_page'
            %td(colspan='4')=will_paginate @domains
      %caption
        =title
        =link_to 'managed csrs', managed_csrs_path(@ssl_slug)
        %ul(style="float: right; display: flex; list-style: none;" )
          %li(style="margin-right: 0.5rem" )
            =submit_tag 'validate ', formaction: "#{validate_selected_domains_path(@ssl_slug)}", style: "padding: 0.5rem", id: "d_name_action_validate", disabled: 'true'
          %li
            =submit_tag 'remove ', formaction: "#{remove_selected_domains_path(@ssl_slug)}", style: "padding: 0.5rem", id: "d_name_action_remove", disabled: 'true'
      %tr.heading_row
        %th
        %th.name(scope="col") Name
        %th(scope="col") Scoped
        %th(scope="col") Status
        %th(scope="col") Validity period
      -@domains.each do |d|
        -dcv = d.domain_control_validations.last
        -validation_status = (dcv.try(:identifier_found) || !d.signed_certificates.empty?) ? 'Validated' : 'Pending validation'
        -validity_period = (validation_status=='Pending validation' || dcv.try(:responded_at).nil?) ? 'n/a' : (30-(Date.today-dcv.responded_at.to_date).to_i).to_s + " days remaining"
        -order_ref = d.certificate_content ? d.certificate_content.certificate_order.ref : 'Team'
        %tr
          %td=order_ref=='Team' ? (check_box_tag "d_name_check[]",d.id, false, :id => "d_name_check_#{d.id}", :class => "d_name_check") : ''
          %td=d.name
          %td=order_ref=='Team' ? 'Team' : (link_to order_ref, new_certificate_order_validation_path(@ssl_slug, d.certificate_content.certificate_order))
          %td.d_name_status=validation_status
          %td=validity_period
