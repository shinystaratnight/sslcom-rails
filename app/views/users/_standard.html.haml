-title="#{Settings.community_name} Customer Dashboard"
-content_for :title, title
-user ||= current_user
.reseller_registration_select_tier
  %h2=title
  %p
    The SSL standard account is designed to streamline your ssl.com certificate
    purchases by providing an all encompassing interface related to your ssl 
    certificates including, validations, tracking, reporting, and Smart SeaLs.
  -if user.ssl_account.has_only_credits?
    %p
      You currently have unused ssl certificate credits. You will need to submit
      a certificate signing request (csr) for a particular pending ssl.com 
      certificate credit in order to process the credit into an ssl certificate 
      for your website.
      =link_to "Click here to see a list of your ssl.com certificate credits.", credits_certificate_orders_path
  -unless user.ssl_account.has_certificate_orders?
    %p
      To get started and enable encryption and trust services on your website
      through an ssl.com certificate, you will need to acquire an ssl.com
      certificate.
      =link_to "Click here to see a list ssl.com certificate products.", certificates_path
  -if Settings.enable_affiliate_program==true && !current_user.is_affiliate?
    .become_reseller_title(style="margin: 10px 0 0")
      %p
        %strong.red NEW! Earn commissions through the #{Settings.community_name} Referral Link Program
      %p
        %a(href="https://#{Settings.community_domain}/affiliate/index.php")
          Click here
        to become an #{Settings.community_name} Referral Link Partner or
        =link_to "click here for more details", details_affiliates_path
  -#
    .become_reseller_title(style="margin: 10px 0 0")
      %p
        %a(href="#{url_for resellers_root_url(:subdomain=>Reseller::SUBDOMAIN)}")
          %strong Become a reseller
          (click here to learn more)
    %p
      Make more profit and save money by reselling ssl.com certificates at a discount.
      =link_to "Click here to sign up for the ssl.com reseller program.", new_reseller_url
#dashboard
  %table(cellspacing="0")
    %caption
      ssl account information for #{user.login} #{"(last logged in #{user.last_login_at.strftime("%b %d, %Y")})" unless user.last_login_at.blank?}
    %tr.heading_row
      %tr.expanded
        %td(colspan="5")
          .certificate_details
            %table(cellspacing="0")
              %tbody
                %tr.alt
                  %th account type
                  %th signup date
                  %th last logged on
                %tr.alt
                  %td standard
                  %td=user.created_at.strftime("%b %d, %Y")
                  %td=user.updated_at.strftime("%b %d, %Y")
            %table(cellspacing="0")
              %tbody
                %tr
                  %td(colspan="5")
                    .half_width_box
                      %ul
                        %li
                          %strong
                            login account
                        %li username: #{user.login}
                        %li email: #{user.email}
                        %li account number: #{user.ssl_account.acct_number}
                        -if permitted_to? :create, :funded_accounts
                          %li available funds: $#{user.ssl_account.funded_account.amount}
                        =render partial: 'ssl_slug_company', locals: {user: user}
                        -if permitted_to? :admin_manage, user
                          :javascript
                            function adjust_funds_#{user.id}()
                            {
                              var amount = prompt("Amount to adjust (in USD)?", '');
                              if (amount == null || amount=="")
                                return;
                              else
                                window.location = '#{adjust_funds_user_url(user)}?amount='+encodeURIComponent(amount);
                            }
                            function change_login_#{user.id}()
                            {
                              var login = prompt("What is the new username? (3 chars min)", '');
                              if (login == null || login=="")
                                return;
                              else
                                window.location = '#{change_login_user_url(user)}?login='+encodeURIComponent(login);
                            }
                          %li=remote_login_link(user)
                        %li=link_to 'edit email address', edit_email_user_url(user)
                        %li=link_to 'change password', edit_password_user_url(user)
                        -unless current_user.is_affiliate?
                          %li=link_to 'become an referral link partner', "https://#{Settings.community_domain}/affiliate/index.php"
                        -unless current_user.ssl_account.is_registered_reseller?
                          %li=link_to 'upgrade to reseller', new_reseller_url
                    .half_width_box
                      -if permitted_to?(:manage, :billing_profiles)
                        %ul
                          %li
                            %strong
                              certificates
                          %li=link_to 'buy certificate', certificates_url
                          %li=link_to 'deposit funds', allocate_funds_url(ssl_slug: @ssl_slug)
                          -if current_user.ssl_account && permitted_to?(:index, :billing_profiles)
                            %li=link_to 'manage billing profiles', billing_profiles_path(ssl_slug: @ssl_slug)
                          %li=link_to 'view purchased certificates', certificate_orders_url(ssl_slug: @ssl_slug)
                          -if user.ssl_account.has_credits?
                            %li=link_to 'use certificate credits', credits_certificate_orders_url(ssl_slug: @ssl_slug)
                    -if(ac = user.ssl_account.api_credential)
                      .half_width_box
                        %ul
                          -unless current_user.is_validations? || current_user.is_billing?
                            %li
                              %strong
                                api credentials
                            %li account key: #{ac.account_key}
                            %li secret key: #{ac.secret_key}
                          %li=link_to "developer tools", developers_certificate_orders_path
                          %li=link_to 'view documentation', "http://docs.sslcomapi.apiary.io/", target: "_new"
            %table(cellspacing="0")
              %tbody
                %tr
                  %td(colspan="5")
                    -unless user.ssl_account.contact.blank?
                      .contact_details_box
                        %ul
                          %li
                            %strong
                              contact
                          -ct = user.ssl_account.contact
                          -unless ct.blank?
                            %li
                              =ct.first_name+" "+ct.last_name
                            -unless ct.po_box.blank?
                              %li
                                =ct.po_box
                            -unless ct.address1.blank?
                              %li
                                =ct.address1
                            -unless ct.address2.blank?
                              %li
                                =ct.address2
                            -unless ct.address3.blank?
                              %li
                                =ct.address3
                            -csp = [ct.city, ct.state, ct.postal_code].reject(&:blank?).join(', ')
                            -unless csp.blank?
                              %li= csp
                            -unless ct.country.blank?
                              %li
                                =ct.country
                            -unless ct.email.blank?
                              %li
                                =ct.email
                            -unless ct.phone.blank?
                              %li
                                =ct.phone
                            %li
                              =link_to 'create/edit contact', edit_ssl_account_url
                          -else
                            none
