-title = "Monthly Invoice"
-content_for :title, title
-system_admins = current_user.is_system_admins?
-descriptions  = @invoice.get_item_descriptions
-total_format  = @invoice.get_amount_format
-funded_amount = @order.get_funded_account_amount if @order
-items_params  = {descriptions: descriptions, total_format: total_format, funded_amount: funded_amount}

#validations.monthly-invoice
  #summary
    %div
      %span TYPE:
      %strong Monthly Invoice
    %div
      %span INVOICE #:
      %strong #{@invoice.reference_number}
    %div
      %span STATUS:
      %strong #{@invoice.status.upcase}
    %div
      %span ITEMS:
      %strong #{@invoice.get_approved_items.count}
    %div
      %span DUE:
      %strong #{@invoice.end_date.strftime('%F')}
  
  
  =render partial: 'items_list', locals: items_params.merge(approved_list: true)
  -if @invoice.get_removed_items.any?
    =render partial: 'items_list', locals: items_params.merge(approved_list: false)
            
-if @invoice.paid? && @order
  =render partial: 'payment_section'

-if system_admins
  #monthly-invoice-actions
    %h3.order_results_header
      Admin Actions
    #invoice-container
      #btn-invoice-generate
        =link_to "&#x27B2; Payment #{MonthlyInvoice::PAYMENT_METHODS_TEXT[:wire]}".html_safe, |
          make_payment_other_invoice_path(@ssl_slug, @invoice.reference_number, ptm_type: :wire), |
          class: 'button-mo-invoice', method: :put
      #btn-invoice-generate
        =link_to "&#x27B2; Payment #{MonthlyInvoice::PAYMENT_METHODS_TEXT[:po]}".html_safe, |
          make_payment_other_invoice_path(@ssl_slug, @invoice.reference_number, ptm_type: :po), |
          class: 'button-mo-invoice', method: :put
      #btn-invoice-generate
        =link_to "&#x2631; Update".html_safe, '#', class: 'button-mo-invoice', id: 'lnk-mo-invoice-update'
    #invoice-admin-errors  
    #invoice-container-admin
      =render partial: 'invoice_update'
            
#monthly-invoice-actions
  %h3.order_results_header
    Actions
  #invoice-container
    #btn-invoice-dwnl
      #{link_to "\u21E9 Download".html_safe, download_invoice_path(@ssl_slug, @invoice.reference_number), class: 'button-mo-invoice'}
    #btn-invoice-update
      #{link_to "&#x2631; Change Address".html_safe, '#', id: 'lnk-update-invoice', class: 'button-mo-invoice'}
    -unless @invoice.paid? && @order
      #btn-invoice-generate
        =link_to "Make Payment".html_safe, |
          new_payment_invoice_path(@ssl_slug, @invoice.reference_number), |
          class: 'button-mo-invoice', method: :get
  
  #invoice-container-errors
  
  #invoice-container-ext
    =render partial: 'orders/invoice_update'