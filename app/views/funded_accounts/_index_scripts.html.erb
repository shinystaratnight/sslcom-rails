<script type="text/javascript">
jQuery.noConflict();
jQuery(function($) {
  $.update_balance_after_load = function(){
    var bracket = $.toMoneyFloat($('#funded_account_amount').val());
    if(bracket == null || bracket == "" || bracket == ".")
      bracket = 0;
    var current_balance = $.toMoneyFloat($('#current_balance').text());
    $('#balance_after_load').text('$'+((parseFloat(bracket)+parseFloat(current_balance)).toFixed(2))+" USD");
  }
  $(document).ready(function() {
    var profile_id = "";
    profile_form_hidden = <%=!initial_display?.empty?%>;
    $('#expand_register_card').click(function(){
      if(profile_form_hidden){
        $('#register_card_form').fadeIn();
        $(this).add('img[id=toggle_billing_profile_form]').attr('src', '/images/hide_billing_profile_form.png');
        profile_id = $(':radio[id*=funded_account_funding_source]:checked').attr("id");
        $(':radio[id*=funded_account_funding_source]').attr("checked","");
        profile_form_hidden = false;
      }
      else{
        $('#register_card_form').fadeOut();
        $(this).add('img[id=toggle_billing_profile_form]').attr('src', '/images/add_new_billing_profile.png');
        $(':radio[id*='+profile_id+']').attr("checked","checked");
        profile_form_hidden = true;
      }
    });
    $.last_delete_clicked=function(){
      if($('.delete_billing_profile').size() <= 1)
        $('.funding_sources_head, #existing_credit_cards').empty();
      $('#register_card_form').fadeIn();
    };
    $('#funded_account_amount').keyup(function () {
      amount = this.value
      this.value = this.value.replace(/((\.\d\d).*)/g, "$2").replace(/[^0-9\.]/g,'');
      $.update_balance_after_load();
    });
    $('#register_card_form').click(function(){
      $(':radio[id*=funded_account_funding_source]').attr("checked","");
    });
    $(':radio[id*=funded_account_funding_source]').click(function(){
      $('#register_card_form').fadeOut();
      $('img[id=toggle_billing_profile_form]').attr('src', '/images/add_new_billing_profile.png');
      profile_form_hidden = true;
    });
    if(profile_form_hidden == false){
      $(':radio[id*=funded_account_funding_source]').attr("checked","");
      $(this).add('img[id=toggle_billing_profile_form]').attr('src', '/images/hide_billing_profile_form.png');
    }
    $.update_balance_after_load();
  });
});
</script>
