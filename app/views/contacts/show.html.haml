-attributes = @contact.attributes
-documents = @contact.validation_histories
-registrant = @contact.is_a?(Registrant)

-content_for :title, @contact.type

-if permitted_to?(:show, @contact.becomes(Contact))
  
  #validations.monthly-invoice
    #summary
      %div
        %span CONTACT:
        %strong #{@contact.type}
      -if registrant
        %div
          %span STATUS:
          %strong #{@contact.status.humanize.upcase}
        %div
          %span FILES:
          %strong #{documents.count}
        %div
          %span TYPE:
          %strong #{@contact.registrant_type.capitalize}
      -else
        %div
          %span DEFAULT:
          %strong #{@contact.saved_default? ? 'YES' : 'NO'}
  #dashboard
    %table.saved_contact{cellspacing: '0', align: 'left'}
      %br
      %tr
        %td{colspan: '2'}
          -if permitted_to?(:destroy, @contact.becomes(Contact))
            =link_to 'Delete', contact_path(@ssl_slug, @contact.id, saved_contact: true), |
            method: :delete, class: 'button_blue button_show', |
            data: {confirm: 'Are you sure you want to delete this contact?'}
          -if permitted_to?(:edit, @contact.becomes(Contact))
            =link_to 'Edit', edit_contact_path(@ssl_slug, @contact.id, saved_contact: true), |
            class: 'button_blue button_show'
      %tr.heading_row
        %th{colspan: '2'} Contact Information
      -list = %w{roles title first_name last_name email phone}
      -list -= ['roles'] if registrant
      -attributes.select{|k,v| list.include? k}.merge(address: @contact.get_address_format).each_with_index do |(k, v), i|
        %tr{class: (i.even? ? 'colored_row' : '')}
          %td
            %strong #{k.to_s.humanize}:
          %td #{k == 'roles' ? v.join(', ') : v}
    
    %table.saved_contact{cellspacing: '0', align: 'left'}
      %br
      %tr.heading_row
        %th{colspan: '2'} Company
      -attributes.select{|k,v| Contact::get_company_fields.include? k}.each_with_index do |(k, v), i|
        %tr{class: (i.even? ? 'colored_row' : '')}
          %td
            %strong #{k.humanize}:
          %td #{v}

    -if documents.any? 
      %table.saved_contact{cellspacing: '0', align: 'left'}
        %br
        %tr.heading_row
          %th{colspan: '2'} Documents ( #{documents.count} )
          -documents.each do |vh|
            %tr
              %td
                =link_to image_tag(vh.registrant_document_url(@contact, :thumb)), vh.registrant_document_url(@contact, :preview), :class=>'img_preview', :rel=>'prettyPhoto'
              %td      
                .documents_list_notes
                  %div
                    .doc_attribute
                      %strong #{vh.document_file_name}
                    .doc_attribute
                      file size: #{number_to_human_size vh.document_file_size}
                    .doc_attribute
                      created on:
                      #{vh.created_at.strftime("%b %d, %Y")}
                    .doc_attribute
                      modified on:
                      #{vh.updated_at.strftime("%b %d, %Y")}
                    =link_to image_tag('preview.png', class: 'blue_icon')+'preview', |
                    vh.registrant_document_url(@contact, :preview), :rel=>'prettyPhoto', class: 'preview_link'
                    =link_to image_tag('download.png', class: 'blue_icon')+'download', |
                    vh.registrant_document_url(@contact)