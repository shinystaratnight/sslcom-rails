module CertificateType
  CERTUM_XSIGN_EV = <<-EOS
MIIF3jCCBMagAwIBAgIQYvgSo19SvXS3GNYQrEtHgzANBgkqhkiG9w0BAQsFADB+
MQswCQYDVQQGEwJQTDEiMCAGA1UEChMZVW5pemV0byBUZWNobm9sb2dpZXMgUy5B
LjEnMCUGA1UECxMeQ2VydHVtIENlcnRpZmljYXRpb24gQXV0aG9yaXR5MSIwIAYD
VQQDExlDZXJ0dW0gVHJ1c3RlZCBOZXR3b3JrIENBMB4XDTE4MDkxMTA5MjgyMFoX
DTIzMDkxMTA5MjgyMFowgYIxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIDAVUZXhhczEQ
MA4GA1UEBwwHSG91c3RvbjEYMBYGA1UECgwPU1NMIENvcnBvcmF0aW9uMTcwNQYD
VQQDDC5TU0wuY29tIEVWIFJvb3QgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkgUlNB
IFIyMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAjzZlQOHWTcDXtOlG
2mvqM0fNTPl9fb69LT3w23jhhqXZuglXaO1XPqDQCEGD5yhBJB/jchXQARr7XnAj
ssufOePPxU7Gkm0mxnu7s9onnQqG6YE3Bf7wcXHswxzpY6IXFJ3vG2fThVUCAtZJ
ycxa4bH3bzKfydQ7iEGonL3Lq9ttewkfokxykNorCPzPPFTOZw+oz12WGQvE43Lr
rdF9HSfvkusQv1vrO6/PgN3B0pYEW3p+pKk8OHakYo6gOV7qd89dAFmPZiw+B6Kj
BSYRaZfqhbcPlgtLyEDhULouisv3D5oi53+aNxPN8k0TayHRwMwi8qFG9kRpnMph
NQcAb9ZhCBHqurj26bNg5U257J8UZslXWNvNh2n4ioYSA0e/ZhN2rHd9NCSFg83X
qpyQGp8hLH94t2S42Oim9HizVcuE0jLEeK6jj2HdzghTreyI/BXkmg3mnxp3zkyP
uBQVPWKchjgGAGYS5Fl2WlPAApiiECtoRHuOec4zSnaqW4EWG7WK2NAAe15itAnW
hmMOpgWVSbooi4iTsjQc2KRVbrcc0N6ZVTsj9CLg+SlmJuwgUHfbSguPvuUCYHBB
XtSuUDkiFCbLsjtzdFVHB3mBOagwE0TlBIqulhMlQg+5U8Sb/M3kHN48+qvWBkof
Z6aYMBzdLNvcGJVXZsb/XItW9XcCAwEAAaOCAVEwggFNMBIGA1UdEwEB/wQIMAYB
Af8CAQIwHQYDVR0OBBYEFPlgu9Tj1TT2uPUGgCWnc9tGaaieMB8GA1UdIwQYMBaA
FAh2zcsH/yT2xc3tu5C84oQ3RnX3MA4GA1UdDwEB/wQEAwIBBjA2BgNVHR8ELzAt
MCugKaAnhiVodHRwOi8vc3NsY29tLmNybC5jZXJ0dW0ucGwvY3RuY2EuY3JsMHMG
CCsGAQUFBwEBBGcwZTApBggrBgEFBQcwAYYdaHR0cDovL3NzbGNvbS5vY3NwLWNl
cnR1bS5jb20wOAYIKwYBBQUHMAKGLGh0dHA6Ly9zc2xjb20ucmVwb3NpdG9yeS5j
ZXJ0dW0ucGwvY3RuY2EuY2VyMDoGA1UdIAQzMDEwLwYEVR0gADAnMCUGCCsGAQUF
BwIBFhlodHRwczovL3d3dy5jZXJ0dW0ucGwvQ1BTMA0GCSqGSIb3DQEBCwUAA4IB
AQB3fEIlifCgb1DYzJtme4/TgnHi06tdHQmJyyzgqYqmnzfE+DBtuvHNVhalGHii
EvHuDXly28VCWb5aq4RKOkXrjuoCkSVtBf1Sys9ClK/Bqb7biO/58Ysoe6hwbikM
0lmi0c27gq2zMGi4/uZ8bzP+fpURtCHunmotpIMitYIz5nKmfLYEJALVDL/6ad8O
Lr+/dZTXKIDIYqdVjcGsvy0mQ12t+VRuJMRF+XTzy/LgDlr4SJjYZvWN7I4BxHyD
82YHj8XFnxgUiD47bn+ykoQa8WX4yV0xZeF+YN0lWLQCunFalTtqr4y6Mmc3pWBW
k5ojwldA7NjrZWoFiQ/blgLF
  EOS

  CERTUM_XSIGN=<<-EOS
MIIF2DCCBMCgAwIBAgIRAOQnBJX2jJHW0Ox7SU6k3xwwDQYJKoZIhvcNAQELBQAw
fjELMAkGA1UEBhMCUEwxIjAgBgNVBAoTGVVuaXpldG8gVGVjaG5vbG9naWVzIFMu
QS4xJzAlBgNVBAsTHkNlcnR1bSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTEiMCAG
A1UEAxMZQ2VydHVtIFRydXN0ZWQgTmV0d29yayBDQTAeFw0xODA5MTEwOTI2NDda
Fw0yMzA5MTEwOTI2NDdaMHwxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIDAVUZXhhczEQ
MA4GA1UEBwwHSG91c3RvbjEYMBYGA1UECgwPU1NMIENvcnBvcmF0aW9uMTEwLwYD
VQQDDChTU0wuY29tIFJvb3QgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkgUlNBMIIC
IjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA+Q/doyt9y9Aq/uxnhabnLhu6
d+Hj9a+k7PpKXZHEV0drGHdrdvL9k+Q9D8IWngtmw1aUnheDhc5W7/IW/QBi9SIJ
VOhlF05BueBPRpeqG8i4bmJeabFf2yoCfvxsyvNB2O3Q6Pw/YUjtsAMUHRAOSxng
u07shmX/NvNeZwILnYZVYf16OO3+4hkAt2+hUGJ1dDyg+sglkrRueiLH+B6h47Ld
kTGrKx0E/6VKBDfphaQzK/3i1lU0fBmkSmjHsqjTt8qhk4jrwZe8jPkd2SKEJHTH
BD1qqSmTzOu4W+H+XyWqNFjIwSNUnRuYEcM4nH49hmylD0CGfAL0XAJPKMuucZ8P
Osgz/hElNer8usVgPdl8GNWyqdN1eANyIso6wx/vLOUuqfqeLLZRRv2vA9bqYGjq
hRY2a4XpHsCz3cQk3IAqgUFtlD7I4MmBQQCeXr9/xQiYohgsQkCz+W84J0tOgPQ9
gUfgiHzqHM61dVxRLhwrfxpyKOcAtdF0xtfkn60Hk7ZTNTX8N+TD9l0WviFz3pIK
+KBjaryWkmo++LxlVZve9Q2JJgT8JRqmJWnLwm3KfOJZX5es6+8uyLzXG1k8K8zy
GciTaydjGc/86Sb4ynGbf5P+NGeETpnr/LN4CTNwumamdu0bc+sapQ3EIhMglFYK
TixsTrH9z5wJuqIz7YcCAwEAAaOCAVEwggFNMBIGA1UdEwEB/wQIMAYBAf8CAQIw
HQYDVR0OBBYEFN0ECQei9Xp9UlMSkpXuOIAlDaZZMB8GA1UdIwQYMBaAFAh2zcsH
/yT2xc3tu5C84oQ3RnX3MA4GA1UdDwEB/wQEAwIBBjA2BgNVHR8ELzAtMCugKaAn
hiVodHRwOi8vc3NsY29tLmNybC5jZXJ0dW0ucGwvY3RuY2EuY3JsMHMGCCsGAQUF
BwEBBGcwZTApBggrBgEFBQcwAYYdaHR0cDovL3NzbGNvbS5vY3NwLWNlcnR1bS5j
b20wOAYIKwYBBQUHMAKGLGh0dHA6Ly9zc2xjb20ucmVwb3NpdG9yeS5jZXJ0dW0u
cGwvY3RuY2EuY2VyMDoGA1UdIAQzMDEwLwYEVR0gADAnMCUGCCsGAQUFBwIBFhlo
dHRwczovL3d3dy5jZXJ0dW0ucGwvQ1BTMA0GCSqGSIb3DQEBCwUAA4IBAQAflZoj
VO6FwvPUb7npBI9Gfyz3MsCnQ6wHAO3gqUUt/Rfh7QBAyK+YrPXAGa0boJcwQGzs
W/ujk06MiWIbfPA6X6dCz1jKdWWcIky/dnuYk5wVgzOxDtxROId8lZwSaZQeAHh0
ftzABne6cC2HLNdoneO6ha1J849ktBUGg5LGl6RAk4ut8WeUtLlaZ1Q8qBvZBc/k
pPmIEgAGiCWF1F7u85NX1oH4LK739VFIq7ZiOnnb7C7yPxRWOsjZy6SiTyWo0Zur
LTAgUAcab/HxlB05g2PoH/1J0OgdRrJGgia9nJ3homhBSFFuevw1lvRU0rwrROVH
13eCpUqrX5czqyQR
  EOS

  def is_dv?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_DV))
    else
      (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\A(basic|free)/
    end
  end

  def is_ov?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_OV))
    else
      (self.is_a?(ApiCertificateRequest) ? target_certificate :
           self).product =~ /\A(wildcard|high_assurance|ucc|premiumssl)/ ||
          is_client_enterprise? || is_client_business? || is_client_pro?
    end
  end
  
  def is_ev?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_EV))
    else
      (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\Aev(?!\-code)/
    end
  end

  def is_iv?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_IV))
    else
      # (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\A(basic|free)/
    end
  end

  def is_evcs?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_EVCS))
    else
      (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\Aev-code-signing/
    end
  end

  # implies non EV
  def is_cs?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_CS))
    else
      (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\A(code[_\-]signing)/
    end
  end

  # this covers both ev and non ev code signing
  def is_code_signing?
    is_cs? or is_evcs?
  end

  def is_test_certificate?
    if self.is_a? SignedCertificate
      !!(decoded.include?(SignedCertificate::OID_TEST))
    else
      # (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\A(basic|free)/
    end
  end

  def is_smime?
    # (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product =~ /\Asmime/
    is_client?
  end

  def is_client?
    (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product.include?('personal')
  end

  def is_smime_or_client?
    is_smime? || is_client? || is_naesb?
  end

  def is_time_stamping?
    false
  end

  def is_naesb?
    (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product.include?('naesb')
  end

  def is_client_basic?
    is_client? and !is_naesb? and
        (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product_root=~/basic\z/
  end

  def is_client_pro?
    (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product_root=~/pro\z/
  end

  def is_client_business?
    (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product_root=~/business\z/
  end

  def is_client_enterprise?
    (self.is_a?(ApiCertificateRequest) ? target_certificate :  self).product_root=~/enterprise\z/
  end

  def is_ov_client?
    is_client_enterprise? or is_client_business?
  end

  def requires_company_info?
    is_client_business? ||
    is_client_enterprise? ||
    is_server? ||
    is_code_signing? ||
    is_ov? ||
    is_naesb?
  end

  def comodo_ca_id
    if is_ev?
      Settings.ca_certificate_id_ev
    elsif is_ov?
      Settings.ca_certificate_id_ov
    else
      Settings.ca_certificate_id_dv
    end
  end

  def client_smime_validations
    if is_ov_client? || is_naesb?
      'iv_ov'
    elsif is_client_pro?
      'iv'
    else
      'none'
    end
  end

  def validation_type
    if is_dv?
      "dv"
    elsif is_cs?
      "cs"
    elsif is_evcs?
      "evcs"
    elsif is_ev?
      "ev"
    elsif is_ov?
      "ov"
    end
  end
end


